[ { "title": "ç•¶ Decodable é‡ä¸Š @propertyWrapper", "url": "/posts/decodable_propertywrapper/", "categories": "tip", "tags": "", "date": "2020-07-18 00:00:00 +0800", "snippet": "åœ¨ Swift 5.1 ä¹‹å¾Œï¼Œè˜‹æœçˆ¸çˆ¸æ¨å‡ºäº† @propertyWrapper ( SE-0258 )ï¼Œå±¬æ€§åŒ…è£å™¨ï¼Œè©³ç´°çš„ä½¿ç”¨åŠèªªæ˜ï¼Œé€™é‚Šå°±ä¸å¤šåšä»‹ç´¹äº†ã€‚å‰›é–‹å§‹çš„æ™‚å€™æœ€å¸¸çœ‹åˆ°çš„æ‡‰ç”¨æ˜¯ Userdefaultsï¼Œæˆ‘è‡ªå·±åœ¨å°ˆæ¡ˆä¸­æ‡‰ç”¨çš„éƒ¨åˆ†å‰‡æ˜¯ Begin/End of dateï¼Œå› ç‚ºæœ‰é¸æ“‡æ—¥æœŸå€é–“çš„éœ€æ±‚ï¼Œæ‰€ä»¥åšäº†ä¸€å€‹é€™æ¨£çš„å±¬æ€§ï¼Œåœ¨ init çš„æ™‚å€™æŒ‡å®šå¥½æ˜¯ Begin or Endï¼Œget çš„æ™‚å€™å°±æœƒå…ˆæ•´ç†ä¸€æ¬¡æ—¥æœŸï¼Œè©³ç´°çš„å¯¦ä½œæˆ‘æ”¾åœ¨ Gist æœ‰èˆˆè¶£çš„åŒå­¸å¯ä»¥åƒè€ƒçœ‹çœ‹ã€‚# æƒ…å¢ƒç•¶æˆ‘å¾…åœ¨ Agency çš„æ™‚å€™ç¶“å¸¸é‡åˆ°ä¸€å€‹å•é¡Œï¼Œå¾Œç«¯çš„ API æ²’æœ‰ç…§ Spec åšï¼Œå°¤å…¶æ˜¯å‹åˆ¥çš„å•é¡Œï¼Œæˆ‘æƒ³é€™æ‡‰è©²å¾ˆå¤šäººéƒ½æœ‰é‡éï¼ŒSpec æ˜æ˜å®šç¾©çš„æ˜¯ Intï¼Œå¾Œç«¯å‚³å»æ˜¯ Stringã€‚æˆ–æ˜¯å› ç‚ºæŸäº›ä¸æ˜çš„åŸå› ï¼Œå¾Œç«¯æ¼å‚³äº†æŸå€‹æ¬„ä½ï¼Œä½†å¯¦éš›ä¸Šé€™å€‹æ¬„ä½æ˜¯å¿…é ˆå­˜åœ¨çš„ã€‚ç”šè‡³æ˜¯å¾Œç«¯ key æ‰“éŒ¯äº†ã€‚æ›´æ·’æ…˜çš„æ˜¯ï¼Œå¦‚æœæ˜¯ Array ä¸­æŸå€‹å€¼éŒ¯äº†ï¼Œæ•´å¤§åŒ…å°±æœƒè§£æå¤±æ•—ã€‚åœ¨ä»¥å‰ï¼Œæˆ‘å€‘æœ‰å¹¾å€‹æ–¹å¼å¯ä»¥è§£æ±ºé€™äº›å•å•é¡Œï¼š è‡ªå·±å®šç¾©ä¸€å€‹å‹åˆ¥ï¼š å¯èƒ½åƒæ˜¯ StringOrInt é€™ç¨®ï¼Œä¸¦å¯¦ä½œ Decodableã€‚ä½†é€™åªèƒ½è§£æ±º String â†” Intï¼Œé€™ç¨®éŒ¯èª¤ã€‚ Decode å¤±æ•—å°±å¤±æ•—ï¼šä½†æ¯æ¬¡å¤±æ•—æˆ‘éƒ½æœƒå°‡ DecodingError ç›´æ¥ç”¨ Alert show åœ¨ç•«é¢ä¸Šï¼Œæ‰€ä»¥åªè¦æœ‰äººæ¸¬åˆ° DecoginError ç›¸é—œçš„å•é¡Œï¼Œå°±å¯ä»¥ç›´æ¥è¢å¹•æˆªåœ–ä¸¦å‚³çµ¦æˆ‘ï¼Œæˆ‘å¯ä»¥æ¯”è¼ƒç¶“é¬†çš„å®šä½å¤±æ•—çš„ APIï¼Œä¸¦é€šçŸ¥å¾Œç«¯ä¿®æ­£ã€‚ï¼ˆç•¶ç„¶é€™ç¨®ä½œæ³•å¿…é ˆé™å®šåœ¨é–‹ç™¼ç’°å¢ƒï¼‰ æŠŠæ‰€æœ‰çš„è®Šæ•¸éƒ½å®£å‘Šæˆ Optionalï¼šä½†é€™åªèƒ½è§£æ±º KeyNotFoundï¼Œè€Œä¸”å¾ŒçºŒçš„é–‹ç™¼ä¸Šéœ€è¦è™•ç†ä¸€å † Optionalã€‚ è‡ªå·±å¯¦ä½œ init(from decoder: Decoder) ï¼šä½†æˆ‘ä¸å¯èƒ½ã€ä¹Ÿä¸æƒ³ç‚ºæ¯å€‹ response model å¯¦åšé€™å€‹ funcï¼Œè²»æ™‚åˆè²»åŠ›ï¼Œå¾ˆä¸å·¥ç¨‹å¸«ã€‚# é‚„æ˜¯æœ‰ä¸€äº›å•é¡Œä¸Šé¢çš„è§£æ³•åœ¨æŸç¨®ç¨‹åº¦ä¸Šåˆ†åˆ¥è§£æ±ºäº† DecodingError çš„å•é¡Œï¼Œä½†ä¾ç„¶æœ‰ä¸€äº›å•é¡Œï¼š è§£æ±ºæ–¹æ³•æ²’æœ‰çµ±ä¸€çš„ä»‹é¢ã€‚ï¼ˆé†œï¼‰ æŸäº›æ–¹æ³•å¯¦ä½œä¸æ˜“ã€‚ï¼ˆéº»ç…©ï¼‰ æŸäº›æ–¹æ³•å‡ºéŒ¯çš„æ™‚å€™å®šä½ä¸å®¹æ˜“ï¼Œå› ç‚ºæœ¬è³ªä¸Šæ˜¯ Bug ï¼Œæ˜¯éœ€è¦è¢«è§£æ±ºçš„ã€‚ å¾Œç«¯çš„é‹ç‚ºæ¯›æ˜¯æˆ‘å€‘æ‰›ï¼Ÿç‚ºæ¯›æ˜¯æˆ‘å€‘è¦æ‰¾å‡ºå•é¡Œåœ¨å“ªï¼Œå†è«‹å¾Œç«¯æ”¹ï¼Ÿï¼ˆğŸ˜  ï¼‰# DecodeStrategyOf course, DecodeStrategy èª•ç”Ÿäº†ã€‚æœ€åˆçš„æƒ³æ³•æ˜¯æƒ³ç”¨ã€Œä¸€å€‹ @propertyWrapperã€ä¾†è§£æ±ºæ‰€æœ‰å•é¡Œï¼Œä½†å˜—è©¦åˆ°ä¸€åŠç™¼ç¾çœŸçš„åšä¸åˆ° ( æˆ–è¨±æ˜¯æˆ‘å¤ªèœäº†QQ )ï¼ŒåŠ ä¸Šä¹‹å‰å­¸åˆ°çš„æ•™è¨“ ã€Œä¸è¦è©¦åœ–åœ¨ä¸€è¡Œ code è£¡é¢åŒ…å±±åŒ…æµ·ã€ã€‚æˆ‘æ±ºå®šé‡å°å„å€‹ç‹€æ³å„è‡ªä½¿ç”¨ä¸€å€‹ @propertyWrapperã€‚è®“æˆ‘å€‘ä¸€å€‹ä¸€å€‹ä¾†çœ‹ï¼š é¦–å…ˆæ˜¯é è¨­å€¼çš„éƒ¨åˆ†ï¼šåœ¨æŸäº›æƒ…æ³ä¹‹ä¸‹ï¼Œæˆ‘å¸Œæœ›è§£æå¤±æ•—çš„æ™‚å€™ï¼ŒModel å¯ä»¥æœ‰é è¨­å€¼ã€‚ æœ€æ—©çš„æƒ³æ³•æ˜¯ï¼Œåœ¨ propertyWrapper init çš„æ™‚å€™ï¼Œé †ä¾¿æŒ‡å®šé è¨­å€¼æ˜¯ä»€éº¼ã€‚ @DecodeHasDefault(&quot;Something error&quot;) ä½†é€™æ¨£çš„åšæ³•æœƒè·Ÿ init(from decoder: Decoder) è¡çªï¼Œæ‰€ä»¥å¾Œä¾†æ”¹ç”¨ Provider çš„æ–¹å¼ä¾†æä¾›é è¨­å€¼ã€‚ public protocol DecodeDefaultProvider { associatedtype Value: Decodable static var defaultValue: Value { get } } @propertyWrapper public struct DecodeHasDefault: Decodable { public var wrappedValue: Provider.Value public init(wrappedValue: Provider.Value) { self.wrappedValue = wrappedValue } public init(from decoder: Decoder) throws { let container = try decoder.singleValueContainer() do { wrappedValue = try container.decode(Provider.Value.self) } catch { wrappedValue = Provider.defaultValue } } } ä½¿ç”¨èµ·ä¾†æœƒåƒæ˜¯é€™æ¨£ struct User: Decodable { struct NameDefault: DecodeDefaultProvider { static var defaultValue: String = &quot;ohlulu&quot; } @DecodeHasDefault var name: String struct AgeDefault: DecodeDefaultProvider { static var defaultValue: Int = 18 } @DecodeHasDefault var age: Int } é€™éƒ¨åˆ†æ¯”è¼ƒå–®ç´”ï¼Œå°±æ˜¯æä¾›ä¸€å€‹ DecodeDefaultProviderï¼Œè®“ DecodeHasDefault åœ¨ catch error çš„æ™‚å€™ä½¿ç”¨ defaultValue å†ä¾†æ˜¯ DecodeArray çš„éƒ¨åˆ†ã€‚ é€™é‚Šæœ‰å…©ç¨®æƒ…æ³ï¼šä¸€ç¨®æ˜¯è§£æå¤±æ•—çš„æ™‚å€™ï¼Œç›´æ¥å¿½ç•¥è©² Elementã€‚å¦ä¸€ç¨®æ˜¯ä½¿ç”¨é è¨­çš„ Elementã€‚ ç¬¬ä¸€ç¨®ï¼šDecodeArrayIgnore @propertyWrapper public struct DecodeArrayIgnore: Decodable { public var wrappedValue: [Value] public init(from decoder: Decoder) throws { var container = try decoder.unkeyedContainer() var result = [Value]() while !container.isAtEnd { do { let element = try container.decode(Value.self) result.append(element) } catch { _ = try container.decode(AnyDecodable.self) } } wrappedValue = result } } é€™é‚Šéœ€è¦æ³¨æ„ï¼Œcatch error çš„æ™‚å€™é‚„æ˜¯è¦ decode æˆåŠŸä¸€æ¬¡ï¼Œä¸ç„¶ element ä¸æœƒå¾ container ä¸­ç§»é™¤ï¼Œæœƒé™·å…¥ä¸€å€‹ç„¡çª®è¿´åœˆï¼Œæ‰€ä»¥ç”¨ä¸€å€‹ç©ºçš„ struct AnyDecodable ä¾†åšé€™ä»¶äº‹ï¼Œå¦‚æœé‚„æ˜¯å¤±æ•—äº†ï¼Œå°± throw å‡ºå»å§ã€‚ ç¬¬äºŒç¨®ï¼šDecodeArrayHasDefault @propertyWrapper public struct DecodeArrayHasDefault: Decodable { public var wrappedValue: [Provider.Value] public init(from decoder: Decoder) throws { var container = try decoder.unkeyedContainer() var result = [Provider.Value]() while !container.isAtEnd { do { let element = try container.decode(Provider.Value.self) result.append(element) } catch { _ = try container.decode(AnyDecodable.self) result.append(Provider.defaultValue) } } wrappedValue = result } } è·Ÿä¸Šé¢å¾ˆåƒï¼Œåªæ˜¯ Generic çš„éƒ¨åˆ†æ”¹æˆäº† DecodeDefaultProviderï¼Œé€™é‚Šæœƒé¸æ“‡æ‹†æˆç†å€‹ @propertyWrapper æ˜¯å› ç‚º ignore ä¸éœ€è¦ Provider ï¼Œç•¶ç„¶ Provider ä¹Ÿå¯ä»¥æä¾›ä¸€å€‹é¡ä¼¼ Optional çš„ enum ä¾†é”æˆé€šç”¨çš„ç›®çš„ï¼Œä½†è€ƒæ…®åˆ°éœ€æ±‚æ˜¯ ignore çš„æ™‚å€™ï¼Œæˆ‘å¸Œæœ›ä½¿ç”¨ä¸Šå¯ä»¥æ›´å–®ç´”ä¸€é»ï¼Œä¸ç”¨å†æŒ‡å®š Providerã€‚ æ‰€ä»¥æœ€çµ‚é¸æ“‡æ‹†æˆå…©å€‹ã€‚ æœ€å¾Œä¸€ç¨®æœ€éº»ç…©ï¼šDecodeUniversal ç›´æ¥ä¸Š Code public typealias LosslessAndDecodable = LosslessStringConvertible &amp;amp; Decodable @propertyWrapper public struct DecodeUniversal: Decodable { public var wrappedValue: Value public init(from decoder: Decoder) throws { let container = try decoder.singleValueContainer() do { wrappedValue = try container.decode(Value.self) } catch { let temp: String if let strValue = try? container.decode(String.self) { temp = strValue } else if let intValue = try? container.decode(Int.self) { temp = &quot;\\(intValue)&quot; } else if let doubleValue = try? container.decode(Double.self) { temp = &quot;\\(doubleValue)&quot; } else { throw error } if let value = Value.init(temp) { wrappedValue = value } else { throw error } } } } é€™é‚Šæœ‰ä¸€å€‹æ¯”è¼ƒå°‘çœ‹åˆ°çš„ protocol LosslessStringConvertibleï¼Œè©³ç´°çš„å®šç¾©å¯ä»¥åƒè€ƒ Documentï¼Œç°¡å–®ä¾†èªªå®ƒæä¾›äº†æˆ‘å€‘ç”¨å­—ä¸²å»ºç«‹ Int, Double ç­‰é¡å‹çš„èƒ½åŠ›ã€‚ æ‰€ä»¥æˆ‘å€‘å…ˆ decode(Value.self) ä¸€æ¬¡çœ‹çœ‹ï¼Œå¤±æ•—çš„è©±ï¼Œæˆ‘å€‘å¾ String -&amp;gt; Int -&amp;gt; Double ä¾æ¬¡ decodeï¼Œåªè¦ decode æˆåŠŸï¼Œå°±æŠŠå€¼è½‰æˆ String å­˜èµ·ä¾†ã€‚å¦‚æœä¾ç„¶ decode å¤±æ•—ï¼Œå‹‡æ•¢çš„ throw å‡ºå»å§ï¼ æ¥è‘—åˆ©ç”¨ LosslessStringConvertible æä¾›çš„ init?(_ description: String) ä¾†å˜—è©¦å»ºç«‹ç‰©ä»¶ï¼Œå¦‚æœé‚„æ˜¯å¤±æ•—ï¼Œå‹‡æ•¢çš„ throw å‡ºå»å§ï¼ åˆ°é€™é‚Šå°±å®Œæˆå•¦ ğŸ˜„ # è®“æˆ‘å€‘å›é ­çœ‹çœ‹âœ… 1. è§£æ±ºæ–¹æ³•æ²’æœ‰çµ±ä¸€çš„ä»‹é¢ã€‚âœ… 2. æŸäº›æ–¹æ³•å¯¦ä½œä¸æ˜“ã€‚âŒ 2. æŸäº›æ–¹æ³•å‡ºéŒ¯çš„æ™‚å€™å®šä½ä¸å®¹æ˜“ï¼Œå› ç‚ºæœ¬è³ªä¸Šæ˜¯ Bug ï¼Œæ˜¯éœ€è¦è¢«è§£æ±ºçš„ã€‚âŒ 3. å¾Œç«¯çš„é‹ç‚ºæ¯›æ˜¯æˆ‘å€‘æ‰›ï¼Ÿç‚ºæ¯›æ˜¯æˆ‘å€‘è¦æ‰¾å‡ºå•é¡Œåœ¨å“ªï¼Œå†è«‹å¾Œç«¯æ”¹ï¼Ÿå¿™äº†è€åŠå¤©ï¼Œæˆ‘å€‘åªè§£æ±ºäº†ä¸€åŠçš„å•é¡Œï¼Ÿåˆ¥ç·Šå¼µï¼Œé‚„æœ‰å¾ŒçºŒã€‚# è®“éŒ¯èª¤å‡ºç¾æ™‚æœ‰ä¸€å€‹ Handleræˆ‘å€‘å…ˆå®£å‘Šä¸€å€‹ protocol DecodeErrorDelegateï¼Œä¸¦å®£å‘Š DecodeStrategy è£¡é¢æœ‰ä¸€å€‹ static var æ˜¯ DecodeErrorDelegateã€‚public protocol DecodeErrorDelegate { func onCatch(error: Error)}public struct DecodeStrategy { public static var errorDelegate: DecodeErrorDelegate?}æ¥è‘—æˆ‘å€‘åœ¨ catch error çš„æ™‚å€™ï¼ŒæŠŠ error é€é DecodeStrategy.errorDelegate?.onCatch(error:) å‚³å‡ºå»ã€‚do { wrappedValue = try container.decode(Provider.Value.self)} catch { DecodeStrategy.errorDelegate?.onCatch(error: error) wrappedValue = Provider.defaultValue}å®Œç¾ï¼Œé€™æ¨£æˆ‘å€‘å°±å¯ä»¥åœ¨ä½¿ç”¨çš„æ™‚å€™æœ‰ä¸€å€‹çµ±ä¸€çš„æ¥å£å¯ä»¥åšäº‹äº†ã€‚ä½ å¯ä»¥åœ¨è‡ªå·±çš„ DecodeErrorDelegate è¨­ç½® flag ï¼Œæ¨™æ³¨ç¾åœ¨æº–å‚™ deocde å“ªå€‹ response modelï¼Œä¸¦åœ¨ onCatch çš„æ™‚å€™å°å‡ºä¾†ï¼Œæˆ–è€…è«‹å¾Œç«¯ç›´æ¥å†é–‹ä¸€éš»æ¥æ”¶ JSON Bug çš„ APIï¼Œæ¯æ¬¡ onCatch éƒ½å‘¼å« API é€šçŸ¥å¾Œç«¯ä¿®æ­£ã€‚æƒ³æ€éº¼ç©å°±æ€éº¼ç©ã€‚å®Œæ•´çš„å°ˆæ¡ˆåœ¨ Githubã€‚å¦‚æœä½ è¦ºå¾—ä¸éŒ¯çš„è©±ï¼Œæ­¡è¿çµ¦å€‹ Star æ”¯æŒä¸€ä¸‹ ğŸ˜„" }, { "title": "CoderEngin-æ¼‚äº®çš„æ–¹å¼å–ç”¨åœ–ç‰‡", "url": "/posts/coderengin/", "categories": "technology", "tags": "python, swift, xcode, script, automation", "date": "2020-04-19 00:00:00 +0800", "snippet": "#èµ·åœ¨ iOS é–‹ç™¼çš„éç¨‹ä¸­ï¼Œå–ç”¨åœ–ç‰‡çš„æ™‚å€™æˆ‘å€‘ç¶“å¸¸ä½¿ç”¨ UIImage(named: &quot;add&quot;) é€™æ¨£çš„æ–¹å¼ï¼Œä½¿ç”¨åœ–ç‰‡æª”å+å­—ä¸²çš„æ–¹å¼ï¼Œé›–ç„¶ç¾åœ¨å¤šæ•¸çš„è¨­è¨ˆå¸«æœƒä½¿ç”¨ zeplin ç­‰å·¥å…·æ–¹ä¾¿å·¥ç¨‹å¸«è¤‡è£½æª”åï¼Œä½†ä½¿ç”¨å­—ä¸²ç¸½æ˜¯ä¸é‚£éº¼æ¼‚äº®ã€‚è€Œä¸”æ¯æ¬¡ä½¿ç”¨éƒ½å€è¦å…ˆæŠŠè¦–çª—åˆ‡åˆ° zeplin åœ¨åˆ‡å›ä¾†ã€‚å€‹äººä½¿ç”¨èµ·ä¾†ç¸½æ„Ÿè¦ºä¸æ˜¯é‚£éº¼æµæš¢ã€‚#æ‰¿å› æ­¤ï¼Œåœ¨ä¹‹å¾Œçš„å°ˆæ¡ˆä¸­ï¼Œæƒ³åˆ°ä½¿ç”¨ UIImage static compute property çš„æ–¹å¼ä¾†å–ç”¨åœ–ç‰‡ï¼Œå­—ä¸²çš„éƒ¨åˆ†åªè¦å¯«ä¸€æ¬¡å°±å¥½ã€‚extension UIImage { static var save: UIImage { return UIImage(named: &quot;save&quot;)! }}// ä½¿ç”¨èµ·ä¾†æœƒåƒé€™æ¨£let imageView = UIImageView(image: .save)ç•¶ç„¶é–‹æºå¥—ä»¶ R.swfit ä¹Ÿå¯ä»¥é”åˆ°é€™æ¨£çš„æ•ˆæœï¼Œä¸é R.swift æ˜¯å¦å¤–å®£å‘Šä¸€å€‹è‡ªå·±çš„å‹åˆ¥ï¼Œæ‰€ä»¥ Swift çš„å‹åˆ¥æ¨æ–·æ²’è¾¦æ³•ç›´æ¥ä½¿ç”¨ .save çš„æ–¹å¼ä¾†å–ç”¨åœ–ç‰‡ã€‚å¿…é ˆ R.image.safe() åƒé€™æ¨£ä½¿ç”¨ï¼Œæ„Ÿè¦ºä¸Šç¨å¾®å†—é•·äº†ä¸€é»ã€‚#è½‰ç”±æ–¼å°ˆæ¡ˆä¸­çš„åœ–ç‰‡æ•¸é‡å¯èƒ½ä¸æ­¢åå¹¾å¼µã€å¹¾åå¼µï¼Œå¯èƒ½æ˜¯ä¸Šç™¾å¼µï¼Œå¦‚æœæ¯å€‹åœ–ç‰‡éƒ½è¦è‡ªå·±æ‰“ä¸€æ¬¡ï¼Œå®¹æ˜“å‡ºéŒ¯ä¸èªªï¼Œæ–°å¢ä¿®æ”¹åˆªé™¤åœ–ç‰‡çš„æ™‚å€™ä¸å¥½ç¶­è­·ï¼Œç”±æ–¼é€™å€‹å‹•ä½œç›¸å°å–®ç´”ï¼Œæ–¼æ˜¯æƒ³åˆ°ä½¿ç”¨è…³æœ¬çš„æ–¹å¼ä¾†å¹«æˆ‘å€‘è§£æ±ºã€‚æ‰€ä»¥æœ‰å…©å€‹å•é¡Œéœ€è¦è§£æ±º æ‰‹å‹•ç”¢ç”Ÿé€™å€‹æª”æ¡ˆå¾ˆéº»ç…©å¯«å®¹æ˜“å‡ºéŒ¯ å¢ä¿®æ”¹åˆªé™¤åœ–ç‰‡çš„æ™‚å€™ä¸å¥½ç¶­è­·å‰›å¥½æƒ³ç©ä¸€ä¸‹ pythonï¼Œå°±æ±ºå®šä½¿ç”¨ python ä¾†å®Œæˆé€™ä»¶äº‹å•¦ã€‚åˆä»£çš„è…³æœ¬ ç”¨èµ·ä¾†å¤§æ¦‚åƒæ˜¯é€™æ¨£ CoderEngine é‚£æ™‚å€™æ˜¯è«‹è¨­è¨ˆå¸«ï¼Œå°‡å°ˆæ¡ˆæ‰€æœ‰çš„åœ–ç‰‡æ‰“åŒ…ä¸€ä»½çµ¦æˆ‘ï¼Œç›´æ¥ parse é€™ä»½æª”æ¡ˆï¼Œé€™å€‹åšæ³•è§£æ±ºäº† å•é¡Œ1 ï¼Œä½† å•é¡Œ2 ä¾ç„¶å­˜åœ¨ã€‚ä¸éé‚„ç®—å ªç”¨ï¼Œæ‰€ä»¥ä¹Ÿå°‡å°±çš„å…ˆç”¨åœ¨å°ˆæ¡ˆä¸Šäº†ã€‚#åˆå¾Œä¾† KuoChingHao å¤§å¤§ï¼Œè½åˆ°æˆ‘å¯«äº†ä¸€å€‹é€™æ¨£çš„è…³æœ¬ä¹‹å¾Œï¼Œèªªä¹Ÿæƒ³ç©ä¸€ä¸‹è…³æœ¬ï¼Œæˆ‘å€‘å…©åˆè¨ˆäº†ä¸€ä¸‹ï¼Œç”± KuoChingHao å¤§å¤§æ“åˆ€ï¼Œåšå‡ºäº†ä»¥ä¸‹ä¿®æ”¹ã€‚ ç›´æ¥ parse Assets.xcasset å°‡æª”åçš„åº•ç·šæ”¹ç‚ºé§å³°ï¼ˆadd_pressed -&amp;gt; addPressedï¼‰ å»æ‰æª”åä¸­çš„ dashï¼ˆadd-1 -&amp;gt; add1ï¼‰ åœ¨å°ˆæ¡ˆä¸­ä½¿ç”¨ build pre-action scriptæˆ‘å¾ŒçºŒæ›´æ–°äº† deep parse ï¼Œè§£æ±ºäº† Assets ä¸­å­˜åœ¨è³‡æ–™å¤¾çš„æƒ…æ³ã€‚ä½¿ç”¨èµ·ä¾†æœƒåƒæ˜¯é€™æ¨£åŸå§‹ç¢¼åœ¨ Github" }, { "title": "Alamofire - APIRouter", "url": "/posts/alamofire-apirouter/", "categories": "technology", "tags": "alamofire, tip", "date": "2019-09-20 00:00:00 +0800", "snippet": "Alamofire - APIRouter2020/6 æ›´æ–°åœ¨ iPlayground2019 è½å®Œç‹å·å¤§å¤§çš„ talk ä¹‹å¾Œï¼Œåˆè‡ªå·±å¯¦ä½œäº†ä¸‰æ¬¡ï¼Œå·²ç¶“æ”¾æ£„ä¸‹é¢çš„å°è£æ–¹å¼ ç¯„ä¾‹åœ¨ Githubï¼Œå› ç‚ºå¯¦ä½œæ¦‚å¿µåŸºæœ¬ä¸Šç­‰åŒç‹å·å¤§å¤§çš„ Talkï¼ˆå¤šäº†ä¸€äº›åƒè€ƒè‡ª Moya çš„æ¦‚å¿µï¼‰æ‰€ä»¥ç­‰ å“ªå¤©å¿ƒæƒ…å¥½ æœ‰ç©ºï¼Œå†ä¾†å¯«ä¸€ç¯‡æ–‡ç« å¥½äº†å“ˆå“ˆå“ˆå“ˆå“ˆã€‚# èµ·Alamofire ç›¸ä¿¡é–‹ç™¼ iOS çš„äººéƒ½ä¸é™Œç”Ÿï¼Œå°±ç®—æ²’ç”¨éä¹Ÿè½ï¼Œéå¸¸å¥½ç”¨çš„ä¸€å€‹ç¬¬ä¸‰æ–¹ç¶²è·¯è™•ç†å¥—ä»¶ï¼Œç¶²è·¯ä¸Šä¹Ÿæœ‰éå¸¸å¤šé—œæ–¼ Alamofire çš„å°è£ï¼Œgoogle alamofire router çš„æ•™å­¸æ–‡ç« ä¹Ÿæ˜¯ä¸€å¤§å †ã€‚å¤§éƒ¨åˆ†çš„æ–‡ç« çœ‹èµ·ä¾†éƒ½æœƒåƒé€™æ¨£ï¼šenum APIRouter { case fetchData case uploadData case deleteData(String) var method: HTTPMethod { switch self { case .fetchData: return .get case .uploadData: return .post case .deleteData: return .post } } var path: String { switch self { case .fetchData: return &quot;/data/list&quot; case .uploadData: return &quot;/data/uplod&quot; case .deleteData: return &quot;/data/delete&quot; } } var parameters: Parameters? { switch self { case .fetchData: return [&quot;time&quot;: DataLastSyncTime] case .uploadData: return [&quot;data&quot;: Data] case .deleteData(let id): return [&quot;id&quot;: id] } } func asURLRequest() throws -&amp;gt; URLRequest { //... retutn ... }}# æ‰¿å‡è¨­ä»Šå¤©æˆ‘å€‘æ˜¯çš„ APP åªæœ‰éœ€è¦å‘¼å« åå¹¾æ”¯ API ï¼Œé€™æ¨£çš„å¯«æ³•æˆ–è¨±æ„Ÿè¦ºä¸åˆ°ä»€éº¼å•é¡Œï¼Œä½†æ˜¯ç•¶ API çš„æ•¸é‡å¢åŠ åˆ° å¹¾åæ”¯ çš„æ™‚å€™ï¼Œå°±æœƒç™¼ç¾æ•´å€‹ router éå¸¸çš„æ··äº‚ï¼Œæ¯æ¬¡å¢åŠ ä¸€æ”¯ API ï¼Œå°±éœ€è¦æŠŠæ•´å€‹æª”æ¡ˆé‡é ­æ»¾å‹•åˆ°å°¾ï¼Œä¸€å€‹ http request çš„ URLã€http methodã€ parametersï¼Œæ•£è½åœ¨æª”æ¡ˆçš„å„è™•ï¼Œä¸ç®¡æ˜¯æ–°å¢é‚„æ˜¯ä¿®æ”¹éƒ½æ¥µç‚ºéº»ç…©ã€‚# è½‰å¾Œä¾†åœ¨ç¶²è·¯ä¸Šç™¼ç¾äº†ä¸€å€‹æ›´å¥½çš„å¯«æ³•ï¼Œä½†åŸæ–‡æ‰¾ä¸åˆ°äº†ï¼Œå¾Œä¾†æˆ‘æ†‘è‘—å°è±¡é‡ç¾äº†ç•¶åˆçœ‹åˆ°çš„æ–‡ç« ã€‚struct APIRouter: URLRequestConvertible { let path: String let method: HTTPMethod var parameters: Parameters? func asURLRequest() throws -&amp;gt; URLRequest { let url = URL(string: &quot;https://www.google.com&quot;)! .appendingPathComponent(path) var urlRequest = URLRequest(url: url) urlRequest.httpMethod = method.rawValue urlRequest.timeoutInterval = 30 // Http common header urlRequest.allHTTPHeaderFields = ESHTTPHeaders.default // add custom do { return try JSONEncoding.default.encode(urlRequest, with: parameters) } catch { fatalError(&quot;\\(error)&quot;) } }}extension APIRouter { static func login(requestModel model: LoginRequestModel) -&amp;gt; APIRouter { return APIRouter(path: &quot;/login&quot;, method: .post, parameters: model.convertToParameter()) }}é€™é‚Šæ‡‰è©²æ˜¯ä½¿ç”¨äº† å·¥å» æ¨¡å¼(factory pattern)æˆ‘æŠŠ enum æ”¹æˆäº† struct ï¼Œç„¶å¾Œä¸€æ¨£ confirm URLRequestConvertible ï¼Œä¸¦å¯¦ä½œ asURLRequest() ï¼Œç„¶å¾Œä½¿ç”¨ static func create é€™å€‹ structã€‚å…¶ä¸­æœ€å¾Œçš„ model.convertToParameter() æ˜¯è‡ªå·±å®£å‘Š &amp;amp; å¯¦ä½œçš„ protocolprotocol ParameterConvertible { func convertToParameter() -&amp;gt; Parameters?}extension ParameterConvertible where Self: Encodable { func convertToParameter() -&amp;gt; Parameters? { do { let data = try JSONEncoder().encode(self) return try JSONSerialization.jsonObject(with: data, options: []) as? [String: Any] } catch { fatalError(&quot;\\(error)&quot;) } }}å‡è¨­ model æ²’æœ‰ç‰¹æ®Šçš„è®ŠåŒ–ï¼Œå°±å¯ä»¥ä½¿ç”¨é è¨­çš„ func convertToParameter() ï¼Œå¦‚æœä»Šå¤© model èˆ‡ api çš„åƒæ•¸å°æ‡‰ä¸èµ·ä¾†ï¼Œä¹Ÿå¯ä»¥ model è‡ªå·±å¯¦ä½œé€™å€‹ func ä¾†å®¢è£½åƒæ•¸çš„çµæ§‹ã€‚# åˆæ‰€ä»¥æˆ‘å€‘æŠŠä¸€å€‹ http request çš„ URLã€http methodã€ parametersâ€¦ çš„è³‡è¨Šï¼Œé€šé€šå¯«åœ¨ä¸€å€‹ func äº†ï¼Œæ˜¯ä¸æ˜¯æ¸…æ¥šè¨±å¤šï¼²ã€‚" }, { "title": "å¿ƒè·¯æ­·ç¨‹-æ‰“é€ ä¸€å€‹å„ªé›…çš„åˆå§‹åŒ–æ¡†æ¶", "url": "/posts/ohswifterframework/", "categories": "tip", "tags": "", "date": "2019-08-13 00:00:00 +0800", "snippet": "æœ€è¿‘å› ç‚ºæ‰‹ä¸Šçš„æ¡ˆå­å‘Šä¸€æ®µè½ï¼Œè·é›¢ä¸‹ä¸€å€‹æ¡ˆå­é€²å…¥é–‹ç™¼éšæ®µä¹Ÿé‚„æœ‰ä¸€é»æ™‚é–“ï¼Œæ‰€ä»¥èˆˆèµ·äº†æ•´ç†è‡ªå·±å¸¸ç”¨çš„ extension çš„æƒ³æ³•ã€‚ä»¥ç›®å‰å¾…åœ¨æ¥æ¡ˆå…¬å¸ä¾†èªªï¼Œé‡è¦çš„å°±æ˜¯ç•«é¢çš„å¿«é€Ÿç”¢å‡ºï¼Œé‚è¼¯çš„éƒ¨åˆ†ç›¸å°ç”¢å“ä¾†èªªï¼Œå…¶å¯¦æ²’æœ‰é‚£éº¼è¤‡é›œã€‚æ‰€ä»¥åœ¨ç•«é¢ç˜‹ç‹‚çš„å»ºç«‹&amp;amp;è¨­ç½®çš„æƒ…æ³ä¸‹ï¼Œä¸€å€‹æ–¹ä¾¿å¥½ç”¨çš„è¨­ç½®æ–¹å¼ï¼Œå…¶å¯¦æ»¿é‡è¦çš„ã€‚åœ¨é‡è¤‡å»ºç«‹ç›¸ä¼¼ä½†å»ä¸ä¸€æ¨£çš„ UI æ™‚ï¼Œä¹Ÿæœƒç›¸å°çš„è¼•é¬†ï¼Œä¸”æ„‰æ‚…ã€‚æ‰€ä»¥é€™ç¯‡æœƒç°¡è¿°ä¸€ä¸‹ï¼Œæˆ‘å¾ å­¸ç¿’ -&amp;gt; å·¥ä½œ -&amp;gt; ç”¢å‡ºä¸€å€‹æ¡†æ¶çš„å¿ƒè·¯æ­·ç¨‹ã€‚ å¾…åœ¨ä¸€é–“æ¥æ¡ˆå…¬å¸ï¼Œå¿«é€Ÿã€æœ‰æ•ˆç‡çš„ç”¢å‡ºï¼Œæ˜¯ä¸€ä»¶éå¸¸é‡è¦çš„äº‹ã€‚# è¹£è·šå­¸æ­¥åœ¨åˆå­¸ Swift çš„æ™‚å€™ï¼Œæˆ‘ç¸½æ˜¯åœ¨æª”æ¡ˆçš„ä¸Šæ–¹å®£å‘ŠUIKité¡çš„å…ƒä»¶ï¼Œä¸¦åœ¨ ViewDidLoadä¸­ä½œåŸä»¶æ¨£å¼çš„è¨­å®šï¼Œçœ‹èµ·ä¾†æœƒæ˜¯é€™æ¨£ğŸ‘‡ã€‚let emailLabel = UILabel()override func viewDidLoad() { super.viewDidLoad() emailLabel.text = &quot;z30262226@gmail.com&quot; emailLabel.font = UIFont.systemFont(ofSize: 14, weight: .regular) emailLabel.textColor = .black emailLabel.textAlignment = .center emailLabel.numberOfLines = 0 emailLabel.backgroundColor = .white emailLabel.layer.cornerRadius = 5 view.addSubview(emailLabel) // ç„¶å¾Œæ˜¯ Autolayout ...}å¦‚æœä»Šå¤©ç•«é¢ä¸Šåªæœ‰ä¸€å…©å€‹ UIå…ƒä»¶ï¼Œé€™æ¨£å¯«æˆ–è¨±ä¸æ˜¯å¤ªå¤§çš„å•é¡Œï¼Œä½†å¯¦éš›æ¡ˆå­ä¸­ä¸å¤ªå¯èƒ½æœ‰é€™æ¨£çš„éœ€æ±‚ï¼Œé‚£åœ¨ç•«é¢ä¸Šçš„æ±è¥¿å¤šèµ·ä¾†ä¹‹å¾Œï¼Œæ•´å€‹ ViewDidLoad æœƒè®Šçš„éå¸¸æ··äº‚ã€‚# é‚¯é„²å­¸æ­¥äººç¸½æ˜¯æœƒé€²æ­¥çš„ï¼Œæ›¾ç¶“çœ‹éé€™éº¼ä¸€å¥è©±ï¼Œå…·é«”æ€éº¼èªªå¿˜äº†ï¼Œä½†æ„æ€å¤§æ¦‚æ˜¯ã€‚ å¦‚æœä¸‰å€‹æœˆå¾Œï¼Œçœ‹ä¸‰å€‹æœˆå‰å¯«çš„ç¨‹å¼ç¢¼ï¼Œé‚„å¯ä»¥æ„Ÿè¦ºå¯«å¾—çœŸå¥½ï¼Œé€™æ˜¯ä¸€ä»¶å¾ˆææ€–çš„äº‹ã€‚é€™å¥è©±ä¹Ÿå¯ä»¥çœ‹å‡ºå·¥ç¨‹å¸«å€‘å­¸ä¸å®Œçš„äººç”Ÿ ğŸ˜‚ã€‚éš¨è‘—çœ‹éçš„ç¨‹å¼ç¢¼ã€æ–‡ç« ã€æ•™å­¸ã€Stack Overflowè¶Šä¾†è¶Šå¤šï¼Œé–‹å§‹æœ‰äº†ç”¨ func åŒ…è£ç¨‹å¼ç¢¼çš„è§€å¿µï¼Œæ–¼æ˜¯æˆ‘æŠŠæ‰€æœ‰é—œæ–¼ UI çš„æ¨£å¼è¨­ç½®ã€Autolayout éƒ½ç”¨ä¸€å€‹ func åŒ…èµ·ä¾†ï¼Œä¸¦æ”¾åœ¨æ•´å€‹æª”æ¡ˆçš„æœ€ä¸‹æ–¹ã€‚çœ‹èµ·ä¾†æœƒæ˜¯ä¸‹é¢é€™æ¨£ğŸ‘‡ã€‚private let emailLabel = UILabel()override func viewDidLoad() { super.viewDidLoad() setupUI()}// MARK: - SetupUIprivate extension ViewController { func setupUI() { emailLabel.text = &quot;z30262226@gmail.com&quot; emailLabel.font = UIFont.systemFont(ofSize: 14, weight: .regular) emailLabel.textColor = .black emailLabel.textAlignment = .center emailLabel.numberOfLines = 0 emailLabel.backgroundColor = .white emailLabel.layer.cornerRadius = 5 view.addSubview(emailLabel) // ç„¶å¾Œæ˜¯ Autolayout ... }}æ¼¸æ¼¸çš„ã€é–‹å§‹åŠ ä¸Šæ¬Šé™çš„å®£å‘Šã€ä½¿ç”¨ // MARK: - ã€ä»¥åŠ extension ä¾†åˆ‡å‰²ç¨‹å¼ç¢¼ã€‚ä¸€ç¬é–“ï¼Œclass å®£å‘Šè®Šæ•¸çš„åœ°æ–¹ï¼Œçœ‹èµ·ä¾† å¾ˆä¹¾æ·¨ã€‚ä½†å¾ˆå¿«çš„ï¼Œæˆ‘ç™¼ç¾ setupUI è£¡é¢å…¶å¯¦å•é¡Œä¾èˆŠã€‚ å®£å‘Šèˆ‡æ¨£å¼çš„è¨­å®šï¼Œè¢«æ‹†æˆäº†å…©éƒ¨åˆ†ã€‚ ç•¶å¤§é‡çš„ UI å…ƒä»¶è¢«æ”¾å…¥çš„æ™‚å€™ï¼Œæ¨£å¼è¨­ç½®+Autolayout ä¸€æ¨£è®“ç¨‹å¼ç¢¼è®Šçš„é›œäº‚ã€‚ çµè«–ï¼šæˆ‘åªæ˜¯æŠŠé›œäº‚çš„ç¨‹å¼ç¢¼æ›äº†ä¸€å€‹åœ°æ–¹æ“ºè€Œå·²ã€‚# æ—¥ç©æœˆç´¯æ¥ä¸‹ä¾†çš„ä¸€æ®µæ™‚é–“ï¼Œå…¶å¯¦çœ‹äº†æ»¿å¤šæ–‡ç« ï¼Œä½†å…¶ä¸­ coding style çš„éƒ¨åˆ†é€šå¸¸åªæœ‰ç‰‡æ®µçš„è¦ç¯„ã€‚é€™æ™‚å€™ï¼Œæ›äº†å·¥ä½œï¼Œçµ‚æ–¼æœ‰äº†åŒæ¨£å¯« iOS çš„åŒäº‹ğŸ˜­ï¼Œç™¼ç¾ä»–çš„ç¨‹å¼ç¢¼æœ‰è¨±å¤šæ–¹ä¾¿çš„ func &amp;amp; property å¯ä»¥å‘¼å«ï¼Œçœ‹äº†ä¸€ä¸‹åŸå§‹ç¢¼ç™¼ç¾å¤šæ•¸æ˜¯ä¾†è‡ªæ–¼ SwifterSwift ï¼Œæˆ‘åƒè€ƒäº†å¥—ä»¶è£¡é¢çš„åšæ³•ï¼Œè‡ªå·±å¯«è‡ªå·±å¸¸ç”¨çš„æ–¹æ³•ï¼Œé¸æ“‡è‡ªå·±å¯«çš„åŸå› æ˜¯å¸Œæœ›è‡ªå·±å¯ä»¥ç†è§£çš„æ›´é€å¾¹ï¼Œä¸¦ä¸”æŠŠé€™ç¨®é‡ç”¨çš„æ¦‚å¿µé¤Šæˆä¸€ç¨®ç¿’æ…£ã€‚åŒæ™‚ï¼Œå° Swift çš„èªæ³•ä¹Ÿç­è§£çš„æ›´æ·±äº†ã€‚å› æ­¤ç”¢ç”Ÿäº†ä¸‹é¢é€™ç¨®å¯«æ³•ã€‚private let emailLabel: UILabel = { let label = UILabel() label.text = &quot;z30262226@gmail.com&quot; label.font = UIFont.systemFont(ofSize: 14, weight: .regular) label.textColor = .black label.textAlignment = .center label.numberOfLines = 0 label.backgroundColor = .white label.cornerRadius = 5 // åˆ©ç”¨ extension å°‡ layer çš„ä½¿ç”¨çœç•¥ return label}()override func viewDidLoad() { super.viewDidLoad() setupUI()}// MARK: - SetupUIprivate extension ViewController { func setupUI() { // emailLabel view.addSubview(emailLabel) // ç„¶å¾Œæ˜¯ Autolayout ... }}é€™æ¨£çš„å¥½è™•æ˜¯ï¼Œæˆ‘æŠŠå®£å‘Šèˆ‡æ¨£å¼çš„è¨­ç½®ï¼Œå¯«åœ¨ä¸€èµ·äº†ã€‚å› ç‚ºä½ˆå±€çš„éƒ¨åˆ†ï¼Œæœ‰æ™‚å€™æœƒä¸€å±¤ç–Šä¸€å±¤ï¼Œå› æ­¤æˆ‘é¸æ“‡å¦å¤–åŒ…æˆä¸€å¡Šï¼Œä¸¦æ”¾åœ¨æœ€ä¸‹é¢ï¼Œè£œå……ä¸€ä¸‹æ”¾åœ¨æœ€ä¸‹é¢çš„åŸå› æ˜¯ï¼šé€šå¸¸ä½ˆå±€çš„éƒ¨åˆ†å¯«å¥½ä¹‹å¾Œï¼Œå°±ä¸å¤ªéœ€è¦å»å‹•åˆ°çš„ï¼Œæœƒä¿®æ”¹çš„éƒ¨åˆ†é€šå¸¸æ˜¯é‚è¼¯ã€‚é€™æ¨£çš„å¯«æ³•ç¶­æŒäº†å¥½é•·ä¸€æ®µæ™‚é–“ï¼Œä½†ä¹…äº†å•é¡Œä¹Ÿæ¼¸æ¼¸æµ®å‡ºä¾†äº†ã€‚ é¦–å…ˆæ˜¯ init closure è£¡é¢ label é‡è¤‡è¼¸å…¥çš„å¾ˆå¤šæ¬¡ã€‚ å†ä¾†æ˜¯ emailLabel å¾Œé¢å¿…é ˆå®£å‘Šå‹åˆ¥ï¼Œå³ä¾¿ closure å›å‚³äº† UILabel çš„ç‰©ä»¶ã€‚å°±ç®—å®£å‘Šäº†å‹åˆ¥ï¼Œå…§éƒ¨çš„ let label = UILabel() &amp;amp; return label çœ‹èµ·ä¾†ä¹Ÿé¡¯å¾—æœ‰é»å¤šé¤˜ã€‚ ç®—ä¸Š init &amp;amp; return &amp;amp; closureå°¾éƒ¨çš„() ç¸½å…±å¤šäº†ä¸‰è¡Œå€‹äººèªç‚ºæ²’ä»€éº¼æ„ç¾©çš„ code å­—å‹èˆ‡æ–‡å­—é¡è‰²çš„éƒ¨åˆ†ï¼ŒåŸºæœ¬ä¸Šæ˜¯æ¯å€‹ UILabel &amp;amp; UIButton éƒ½éœ€è¦è¨­ç½®çš„å±¬æ€§ï¼Œæ¯æ¬¡åˆä½¿ç”¨çš„æ™‚å€™éƒ½è¦é‡æ–°æ‰“ä¸€æ¬¡ï¼›æˆ‘è¦ºå¾—ä¸è¡Œã€‚ # ç•°æƒ³å¤©é–‹â€”æ›¾ç¶“èµ°éŒ¯çš„é‚£æ®µè·¯ã€‚é€™æ˜¯ä¸€å€‹æˆ‘è‡ªå·±å‰µé€ ï¼Œå»åœ¨ç”¨éä¹‹å¾Œç«‹åˆ»æ”¾æ£„çš„å¯«æ³•ï¼Œæœƒæ‹¿å‡ºä¾†è¬›æ˜¯å› ç‚ºï¼šå„˜ç®¡è¢«æˆ‘æ£„ç”¨äº†ï¼Œä½†åœ¨é€™å€‹éç¨‹ä¸­ä¹Ÿäº†è§£æ€æ¨£æ˜¯ä¸å¥½çš„è¨­è¨ˆã€‚ç‚ºæ—¥å¾Œç´¯ç©äº†äº›è¨±çš„åŸºçŸ³ï¼Ÿenum AppFont { // åˆ©ç”¨ Font size + æµæ°´è™Ÿï¼Œä¾†ç‚ºæ¯å€‹ case å‘½å case style2401, style2402, style2403, style2001, style2002 var attributes: [NSAttributedString.Key: Any] { switch self { case .style2401: return createAttribute(weight: .regular, size: 24, color: .black, backgroundColor: .white, alignment: .left) case .style2402: return createAttribute(weight: .semibold, size: 24, color: .words, alignment: .right) // case ....}// ç„¶å¾Œç‚ºæ¯ä¸€å€‹å¯ä»¥è¨­ç½® Font çš„ UIKit å…ƒä»¶å¯«ä¸€å€‹æ–¹æ³•å»æ¥æ”¶ï¼Œä¸¦å¯¦éš›è¨­ç½®é€™äº›æ¨£å¼è¨­å®šé€™é‚Šæˆ‘æ›¾ç¶“æŠŠç”¨åˆ°çš„çµ„åˆéƒ½ç”¨ä¸€å€‹ enum ä¾†åŒ…è£ï¼Œç„¶å¾Œåˆ©ç”¨ font size ä¾†ç•¶ä½œå‘½åçš„é–‹é ­ã€‚æ›¾ç¶“çš„æˆ‘ä»¥ç‚ºé€™æ¨£å¾ˆå®Œç¾ã€‚ä½†éš¨è‘—æ¡ˆå­çš„æ¨é€²ï¼Œæ¨£å¼éŒ¯èª¤çš„æ™‚å€™ï¼Œè¿½è¹¤å›°é›£ï¼Œè¨±å¤šæ¨£å¼å…¶å¯¦åªæ˜¯ç½®å·¦ç½®å³çš„å·®åˆ¥ï¼Œä½†å»å¤šäº†ä¸€å€‹ enum caseã€‚æœ‰æ¥µå°çš„å·®ç•°ï¼Œä½†çµ„åˆèµ·ä¾†ï¼Œæ•¸é‡å¾ˆé©šäººã€‚åŠ ä¸Šè¨­è¨ˆå¸«æœ‰æ™‚å€™æœƒèª¿æ•´æˆ–æ–°å¢æ¨£å¼æ™‚ï¼Œé€™æ¨£çš„å¯«æ³•å†æ–°å¢åŠä¿®æ”¹ä¸Šæ¥µç‚ºå›°é›£ï¼Œå› æ­¤ç”¨äº†ä¸€æ®µå¾Œæ™‚é–“ç«‹åˆ»æ”¾æ£„ã€‚ ä¸è¦è©¦åœ–åœ¨ä¸€è¡Œ code è£¡é¢åŒ…å±±åŒ…æµ·ã€‚# Ready goæ¥ä¸‹ä¾†çš„é€™å€‹æ™‚æœŸï¼Œæœ‰å…©å€‹é»åŒæ™‚çµ¦äº†æˆ‘éˆæ„Ÿ åœ¨ iOS@Taipei æ™‚è½åˆ°äº†ä¸€ä½è¬›è€…ï¼Œåœ¨åˆ†äº«çš„æ™‚å€™ä»‹ç´¹äº†ä¸€ä¸‹ä»–è‡ªè£½çš„å¥—ä»¶ ChainsKit ã€‚ åœ¨ä¸€å€‹å…¨æ–°çš„æ¡ˆå­ä¸­æˆ‘é–‹å§‹ä½¿ç”¨ RxSwift äº†ã€‚è€å¯¦èªªåœ¨ç¬¬ä¸€æ¬¡çœ‹åˆ° ChainsKit ä¹‹å¾Œï¼Œä¸¦æ²’æœ‰å¤ªå¤šçš„æ„Ÿè¦ºã€‚ä½†åœ¨æˆ‘æ¼¸æ¼¸ç†Ÿæ‚‰ RxSwiftï¼Œä¸¦è‘—è¿·æ–¼ RxSwift ä¹‹å¾Œï¼Œæˆ‘ç™¼ç¾ ChainsKit æ˜¯ä¸€ç¨®å¾ˆæ£’å¯«æ³•ã€‚é‚£ç‚ºä»€éº¼æˆ‘æ²’æœ‰ä½¿ç”¨ ChainsKit è€Œæ˜¯é¸æ“‡æ‰“é€ ä¸€å€‹è‡ªå·±çš„æ¡†æ¶å‘¢ã€‚å› ç‚ºå¾ˆä¸å·§çš„ï¼Œåœ¨æˆ‘ä½¿ç”¨å¾ SwifterSwift å­¸ç¿’åˆ°çš„ä¸€å€‹ UIView æ“´å±•: var borderColor ä¸å°å¿ƒèˆ‡æ¡ˆå­ä¸­å¦ä¸€å€‹å¥—ä»¶çš„å‘½åè¡çªäº†ã€‚é›–ç„¶æˆ‘æ”¹ç”¨ xx_borderColor é€™æ¨£çš„å‘½åä¾†è§£æ±ºäº†é€™å€‹å•é¡Œã€‚ä½†åº•ç·šå¼çš„å‘½åæ–¹å¼å¯¦åœ¨å¾ˆä¸ç¬¦åˆå€‹äººçš„å–œå¥½â€¦ã€‚æ¥è‘—å†æŸ¥è©¢ RxSwift è³‡æ–™çš„æ™‚å€™ï¼Œç™¼ç¾äº†ä¸€ç¯‡å¾ˆæ£’çš„æ–‡ç«  [medium][https://medium.com/@DianQK/%E5%86%99%E6%9B%B4%E4%BC%98%E9%9B%85%E7%9A%84-swift-%E6%A1%86%E6%9E%B6-rx-tap-rx-tap-af0c417da3d6]ï¼Œå¯ä»¥è‡ªè¨‚ä¸€å€‹ namespacing çš„å¯¦ä½œæ–¹æ³•ã€‚ç¸½çµäº†ä¸€ä¸‹å¹¾å€‹é»ï¼ˆç”¨ Rx tap èˆ‰ä¾‹ï¼‰ï¼š rx_Tapï¼šä¸€ç¨®å swift é¢¨æ ¼çš„é¢¨æ ¼ rxTapï¼šç¬¦åˆ swift é¢¨æ ¼çš„é¢¨æ ¼ï¼Œä½†èªæ„ä¸Šå®¹æ˜“é€ æˆå›°æƒ‘ reactiveTapï¼šå¤ªå†—é•·äº†ä»¥ä¸Šå¹¾é»éƒ½é‚„æœ‰å…©å€‹å•é¡Œå°±æ˜¯ï¼š 1. ç‚ºåŸæœ¬å°±å¾ˆå¤šçš„è‡ªå‹•è£œå…¨é¸é …ï¼Œåˆæ·»ä¸Šäº†è¨±å¤šé¸æ“‡ 2. éƒ½åªæ˜¯æ›æ¹¯ä¸æ›è—¥ç¶œåˆä»¥ä¸Šç¨®ç¨®åŸå› ï¼Œæœ€çµ‚æ±ºå®šä½¿ç”¨ rx.tap é€™ç¨®æ–¹å¼ ï¼ˆå…¶å¯¦åªæ˜¯ç”¨äº†åˆ¥äººçš„çµè«–ä¾†å¯¦ä½œï¼‰ä¸¦ä¸”èªçœŸçš„å¯¦ä½œæˆä¸€å€‹æ¡†æ¶ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ–°æ¡ˆå­éƒ½æ˜¯æ•´åŒ…æª”æ¡ˆçš„æ‹‰ä¾†æ‹‰å»ã€‚æ‰€ä»¥ï¼ŒOhSwifter èª•ç”Ÿå•¦ï¼å®ƒç”¨èµ·ä¾†æœƒåƒé€™æ¨£ ğŸ‘‡private let ohButton = UIButton().oh .title(&quot;Button Wording&quot;, for: .normal) .titleColor(.black, for: .normal) .titleColor(.gray, for: .normal) .cornerRadius(12) .border(color: .darkGray, width: 1) .done()é€™å€‹æ¡†æ¶è§£æ±ºäº†å¹¾å€‹å•é¡Œï¼š ä»¥é»éˆå¼çš„æ–¹å¼ï¼Œå°‡UIå…ƒä»¶çš„å®£å‘Šèˆ‡æ¨£å¼è¨­ç½®æ”¾åœ¨ä¸€èµ·ã€‚ ä»¥è¿”å› self çš„æ–¹å¼ï¼Œè§£æ±ºäº† init closure ä¸­é‡è¤‡è¼¸å…¥ label çš„å•é¡Œã€‚ å°‡ border color &amp;amp; width æ”¾åœ¨åŒä¸€å€‹ fun ä¸­ï¼Œå› ç‚ºé€™å…©å€‹å±¬æ€§å¹¾ä¹æ˜¯äº’ç›¸ç¶å®šçš„ï¼Œè«¸å¦‚æ­¤é¡çš„é‚„æœ‰é™°å½±çš„è¨­ç½®ã€‚ç•¶ç„¶ï¼Œåœ¨å¯¦ä½œæ¡†æ¶çš„æ™‚å€™ç™¼ç¾ï¼Œå¿…é ˆåœ¨å®£å‘Šéˆçš„å°¾éƒ¨ä½¿ç”¨ .base ä¾†åšè§£åŒ…çš„å‹•ä½œï¼Œçœ‹èµ·ä¾†æœ‰é»æ€ªï¼Œä¸å¤ªç¬¦åˆèªæ„ï¼Œæ‰€ä»¥æˆ‘åŠ ä¸Šäº† .done() æ–¹æ³•ä¾†å–å‡º base çš„å€¼ã€‚ä½†æœ¬è³ªä¸Šä¸€æ¨£æ˜¯æ›æ¹¯ä¸æ›è—¥ï¼›æœ‰é»å¤šé¤˜ï¼Œä½†ç›®å‰æ²’æœ‰æ›´å¥½çš„æƒ³æ³•äº†ï¼Œå¥½åœ¨æ•´é«”è€Œå·²ï¼Œçœ‹èµ·ä¾†é‚„ç®—é †çœ¼ã€‚å¥½äº†ï¼Œä¸€å€‹æŒ‰ç…§è‡ªå·±å¿ƒæ„æ‰“é€ çš„æ¡†æ¶ï¼Œç”¨èµ·ä¾†å°±æ˜¯èˆ’æœã€‚å„˜ç®¡åœ¨ä¸ä¹…çš„å°‡ä¾†å¯èƒ½æœƒå› ç‚ºç¨®ç¨®åŸå› ï¼Œè®“æˆ‘æ£„ç”¨é€™å€‹æ¡†æ¶ã€‚ ä½†é€™ç¸½æ­¸æ˜¯ä¸€å€‹æ–°é–‹å§‹ã€‚ğŸ˜å¦‚æœä½ æœ‰æ›´å¥½çš„æƒ³æ³•ï¼Œæ­¡è¿æå‡ºä¾†ä¸€èµ·è¨è«–ã€‚" }, { "title": "Swift è‡ªè¨‚è½‰å ´å‹•ç•«ï¼Œæ‰‹å‹¢(ä¸‹)", "url": "/posts/swift-custom_transition_animation_2/", "categories": "animation", "tags": "animation, swift, transition", "date": "2019-03-31 00:00:00 +0800", "snippet": "Demo GIFé€™ç¯‡ä¸»è¦è¬›æ‰‹å‹¢çš„ä½¿ç”¨ï¼Œé—œæ–¼å‹•ç•«å¯¦ä½œçš„éƒ¨åˆ†ï¼Œåœ¨ ä¸Šç¯‡ æœ‰è©³ç´°çš„codeæ¥ä¸‹ä¾†è¦åœ¨æˆ‘å€‘å»ºç«‹çš„ CustomTransition è£¡é¢ï¼Œè·Ÿç³»çµ±èªªï¼šæˆ‘å€‘çš„äº’å‹•äº‹ä»¶è¦é€éèª°ä¾†ç®¡ç†äº’å‹•ã€‚class CustomTransition: NSObject, UIViewControllerTransitioningDelegate { // ... let interaction = UpToDownIneraction() func interactionControllerForPresentation(using animator: UIViewControllerAnimatedTransitioning) -&amp;gt; UIViewControllerInteractiveTransitioning? { return nil } func interactionControllerForDismissal(using animator: UIViewControllerAnimatedTransitioning) -&amp;gt; UIViewControllerInteractiveTransitioning? { print(interation.interacting) return interaction.interacting ? interaction : nil }}é€™é‚Šä½¿ç”¨ interaction.interacting ? interaction : nil é€™æ¨£çš„å¯«æ³•ï¼Œç¿»æˆä¸­æ–‡å¤§æ¦‚çš„æ„æ€æ˜¯ï¼šå¦‚æœå·²ç¶“åœ¨è™•ç†äº’å‹•äº†ï¼Œé‚£å°±ä¸ç”¨å¤šå˜´è·Ÿç³»çµ±èªªèª°ä¾†è™•ç†äº’å‹•ã€‚æ‰€ä»¥åœ¨ UpToDownIneraction è£¡é¢æˆ‘å€‘å®£å‘Šä¸€å€‹ interacting ä¾†è² è²¬æ˜¯å¦åœ¨äº’å‹•ä¸­ã€‚æ³¨æ„é€™å…©å€‹ func åœ¨ UIViewControllerTransitioningDelegate è£¡é¢å…¶å¯¦æ˜¯ optional çš„ï¼Œå¦‚æœä¸å¯¦åšçš„è©±ï¼Œç³»çµ±æœƒä½¿ç”¨åŸç”Ÿçš„æ‰‹å‹¢ï¼Œex: navigation æœƒæœ‰å³æ»‘è¿”å›çš„æ‰‹å‹¢ã€‚å›å‚³ nil åŒç†ã€‚**é‚£é€™é‚Šåªä½¿ç”¨ interactionControllerForDismissal ï¼Œä¹Ÿå°±æ˜¯ dismiss éœ€è¦çš„é€éèª°ä¾†ç®¡ç†ã€‚å› ç‚ºåœ¨å‡ºç¾çš„éƒ¨åˆ†å¦‚æœä½¿ç”¨æ‰‹å‹¢ï¼Œä¸ç†Ÿæ‚‰çš„ä½¿ç”¨è€…å¯èƒ½æœƒç”¢ç”Ÿç–‘æƒ‘ï¼Œé™¤éUIä¸Šæœ‰æ˜é¡¯çš„æç¤ºï¼Œä¾‹å¦‚ä¸€å€‹ç®­é ­ï¼ŒåŠ ä¸Šä¸€å€‹æŠ–å‹•çš„å‹•ç•«ï¼Œä¸ç„¶ä½¿ç”¨é»æ“Šäº‹ä»¶ä¾†ç•¶ä½œå‡ºç¾çš„è§¸ç™¼æ¢ä»¶æœƒæ˜¯æ¯”è¼ƒå¥½çš„é¸æ“‡ã€‚æ¥ä¸‹ä¾†å°±æ˜¯å¯¦ä½œäº’å‹•ç®¡ç†äº†å…ˆæŠŠ class å»ºç«‹èµ·ä¾†ï¼Œä¸¦å¯«å¥½æˆ‘å€‘éœ€è¦çš„ propertyclass UpToDownIneraction: UIPercentDrivenInteractiveTransition { var interacting: Bool = false private var couldComplete: Bool = false private weak var presentingViewController: UIViewController? = nil}ç´°å¿ƒçš„äººå¯èƒ½ç™¼ç¾æˆ‘å€‘ç¹¼æ‰¿çš„ class æ˜¯ UIPercentDrivenInteractiveTransition è€Œä¸ä¸Šé¢ func éœ€è¦å›å‚³çš„ UIViewControllerInteractiveTransitioning é€™æ˜¯è˜‹æœæä¾›çš„ä¸€å€‹æ–¹ä¾¿çš„é¡åˆ¥ï¼Œå¦‚æœå‹•ç•«ä¸­ä½¿ç”¨çš„æ˜¯ UIView.animationï¼Œé‚£æˆ‘å€‘å°±åªéœ€è¦å‘Šè¨´ç³»çµ±ç¾åœ¨è¦ run åˆ°ç¬¬å¹¾ % ã€‚ interacting æ˜¯ç®¡ç†æ˜¯å¦åœ¨äº’å‹•ä¸­ couldComplete è² è²¬çš„æ˜¯ï¼Œå¦‚æœæ»‘åˆ°ä¸€åŠï¼Œå°±æ”¾é–‹æ‰‹æŒ‡ï¼Œé€™æ™‚å€™æ˜¯è¦è·‘å®Œæ•´å€‹å‹•ç•«ï¼Œé‚„æ˜¯æ¢å¾©å‹•ç•«å‰çš„ç‹€æ…‹ã€‚ presentingViewController æ˜¯æˆ‘å€‘éœ€è¦åŠ ä¸Šæ‰‹å‹¢çš„ ViewController ï¼ˆé™¤äº†é…åˆæ‰‹å‹¢ï¼ŒåŸ·è¡Œå‹•ç•«ï¼Œé‚„éœ€è¦è·Ÿç³»çµ±èªªæˆ‘å€‘è¦ dismiss é‚„æ˜¯ popï¼Œæ‰€ä»¥éœ€è¦ä¸€å€‹ property å­˜èµ·ä¾†æ–¹ä¾¿ä¹‹å¾Œåˆ¤æ–·ï¼‰ ç„¶å¾Œå¯¦ä½œæˆ‘å€‘éœ€è¦çš„æ–¹æ³•é¦–å…ˆåŠ ä¸Šæ‰‹å‹¢ï¼Œä¸¦åšå¥½æ‰‹å‹¢éœ€è¦åŸ·è¡Œçš„ç©ºæ–¹æ³•class UpToDownIneraction: UIPercentDrivenInteractiveTransition { // ... func wireGesture(on viewController: UIViewController) { presentingViewController = viewController let gesture = UIPanGestureRecognizer(target: self, action: #selector(handleGesture(_:))) viewController.view.addGestureRecognizer(gesture) } @objc func handleGesture(_ gestureRecoginizer: UIPanGestureRecognizer) { // ... }}æ¥è‘—å¯¦ä½œæ‰‹å‹¢åŸ·è¡Œçš„æ–¹æ³•ï¼Œ UIPercentDrivenInteractiveTransition é¡åˆ¥æä¾›äº†æˆ‘å€‘å¹¾å€‹æ–¹æ³• update(_ percentComplete: CGFloat) cancel() finish()å¾ˆæ˜é¡¯æˆ‘å€‘åªéœ€è¦ç®—å¥½æ‰‹å‹¢åœ¨ç•«é¢ä¸Šç§»å‹•çš„æ¯”ä¾‹ï¼Œç„¶å¾Œä½¿ç”¨ update ä¾†æ›´æ–°ï¼Œä¸¦åœ¨é©ç•¶çš„æ™‚æ©Ÿè·Ÿç³»çµ±èªªæˆ‘å€‘è¦ å–æ¶ˆ æˆ–æ˜¯ å®Œæˆ å‹•ç•«ï¼Œå³å¯ã€‚class UpToDownIneraction: UIPercentDrivenInteractiveTransition { // ... @objc func handleGesture(_ gestureRecoginizer: UIPanGestureRecognizer) { let gestureView = gestureRecoginizer.view! let trainsiton = gestureRecoginizer.translation(in: gestureView) switch gestureRecoginizer.state { case .began: print(&quot;began&quot;) interacting = true if let naviController = presentingViewController?.navigationController { naviController.popViewController(animated: true) } else { presentingViewController?.dismiss(animated: true, completion: nil) } case .changed: var fraction = trainsiton.y / gestureView.frame.height print(&quot;\\(fraction)&quot;) fraction = max(fraction, 0.0) fraction = min(fraction, 1) couldComplete = fraction &amp;gt; 0.4 update(fraction) case .cancelled, .ended: interacting = false if couldComplete == false || gestureRecoginizer.state == .cancelled { cancel() } else { finish() } default: break } }}484å¾ˆç°¡å–®ï¼Ÿé€™é‚Šç‰¹åˆ¥æé†’ä¸€ä¸‹ï¼Œå¦‚æœå‹•ç•«ä¸æ˜¯ä½¿ç”¨ UIView.animation ä¾†å¯¦ä½œï¼Œé‚£éº½ UIPercentDrivenInteractiveTransition å°±ä¸é©ç”¨äº†ã€‚é€™å€‹å‘å®³æˆ‘æäº†å¥½ä¹…ã€‚è¬äº‹ä¿±å‚™åªæ¬ æ±é¢¨@objc func buttonPressed() { let vc = PresentSecondViewController() animation.destinationPoint = button.center vc.transitioningDelegate = animation vc.modalPresentationStyle = .custom animation.interaction.wireGesture(on: vc) present(vc, animated: true, completion: nil)}å®Œæ•´çš„ç¯„ä¾‹åœ¨ Github" }, { "title": "Swift è‡ªè¨‚è½‰å ´å‹•ç•«ï¼Œæ‰‹å‹¢(ä¸Š)", "url": "/posts/swift-custom_transition_animation/", "categories": "å‹•ç•«", "tags": "animation, swift, transition", "date": "2019-03-10 00:00:00 +0800", "snippet": "Demo GIFæœ¬ç¯‡ä¸»è¦è¬›è¿°å‹•ç•«çš„å¯¦ä½œï¼Œæ‰‹å‹¢çš„éƒ¨åˆ†ç•™åœ¨ä¸‹ç¯‡å‹•ç•«çš„åŸç†æ˜¯ä½¿ç”¨ maskView ç•«å‡ºä¸€å€‹åœ“ï¼Œç„¶å¾Œå°åœ“é€²è¡Œæ”¾å¤§ç¸®å°é–‹å§‹ï¼é¦–å…ˆæˆ‘å€‘å…ˆå»ºç«‹ä¸€å€‹ class ç”¨ä¾†ç®¡ç†æˆ‘å€‘ present &amp;amp; dismiss çš„å‹•ç•«è¦é€éèª°ä¾†å‹•ã€‚class CustomTransition: NSObject, UIViewControllerTransitioningDelegate { // æ“´æ•£çš„ä¸­å¿ƒé» var destinationPoint = CGPoint.zero private lazy var presentAnimation = CustomPresentAnimation(startPoint: destinationPoint) private lazy var dismissAnimation = CustomDismissAnimation(endPoint: destinationPoint) func animationController( forPresented presented: UIViewController, presenting: UIViewController, source: UIViewController ) -&amp;gt; UIViewControllerAnimatedTransitioning? { return presentAnimation } func animationController(forDismissed dismissed: UIViewController) -&amp;gt; UIViewControllerAnimatedTransitioning? { return dismissAnimation }}é»UIViewControllerTransitioningDelegate é€²å»çœ‹ï¼Œå¯ä»¥ç™¼ç¾è£¡é¢æœ‰äº”å€‹ func éƒ½æ˜¯ optionalï¼Œæ˜¯é€™æ¨£çš„ï¼Œå¦‚æœä¸å¯¦ä½œï¼Œé‚£ç³»çµ±å°‡æœƒä½¿ç”¨åŸç”Ÿçš„æ•ˆæœä¾†é¡¯ç¤ºã€‚æˆ‘åœ¨ç¶²è·¯ä¸ŠæŸ¥çš„å¤šæ•¸ç¯„ä¾‹ï¼Œæ˜¯ç›´æ¥åœ¨ class CustomTransition å¯¦ä½œé€™å€‹ protocol ç„¶å¾Œ return selfï¼Œä½†ç‚ºäº†è®“ code çœ‹èµ·ä¾†ç°¡å–®ä¸€é»ï¼Œæˆ‘é¸æ“‡å¦å¤–å»ºç«‹å…©å€‹ class confirm é€™å€‹ protocolPresentclass CustomPresentAnimation: NSObject , UIViewControllerAnimatedTransitioning { var startPoint: CGPoint // æ“´æ•£çš„èµ·å§‹é» private let durationTime = 0.45 // å‹•ç•«æ™‚é–“ init(startPoint: CGPoint) { self.startPoint = startPoint super.init() } func transitionDuration(using transitionContext: UIViewControllerContextTransitioning?) -&amp;gt; TimeInterval { return durationTime } func animateTransition(using transitionContext: UIViewControllerContextTransitioning) { // ... }}æ¥è‘—æˆ‘å€‘åœ¨ func animateTransition è£¡é¢å¯¦ä½œæˆ‘çš„å€‘æƒ³è¦çš„å‹•ç•«æ•ˆæœå•¦func animateTransition(using transitionContext: UIViewControllerContextTransitioning) { // å–å‡º toView, åœ¨ä¸Šé¢çš„ç¤ºæ„åœ–ä¸­ä»£è¡¨çš„å°±æ˜¯ A ç•«é¢ guard let toView = transitionContext.viewController(forKey: .to)?.view else { return } // å–å‡º container view let containerView = transitionContext.containerView // å»ºç«‹æˆ‘å€‘çš„ mask viewï¼Œä¸¦ååˆæ­¥è¨­ç½® let maskView = UIView() maskView.frame.size = CGSize(width: 1, height: 1) maskView.center = startPoint maskView.backgroundColor = .black maskView.layer.cornerRadius = 0.5 toView.mask = maskView containerView.addSubview(toView) // å› ç‚ºæœ€çµ‚ mask view çš„åœ“ï¼Œéœ€è¦è¦†è“‹åˆ°æ•´å€‹ç•«é¢ï¼Œæ‰€ä»¥è¨ˆç®—å‡º mask viewéœ€è¦çš„å¤§å° let containerFrame = containerView.frame let maxY = max(containerFrame.height - startPoint.y, startPoint.y) let maxX = max(containerFrame.width - startPoint.x, startPoint.x) let maxSize = max(maxY, maxX) * 2.1 // æœ€å¾Œæˆ‘å€‘ä½¿ç”¨ UIView.animation é¡¯å¼å‹•ç•«ï¼Œå°‡æˆ‘å€‘çš„ mask view æ“´æ•£åˆ°æ•´å€‹ç•«é¢ UIView.animate( withDuration: durationTime, delay: 0, options: [.curveEaseOut], animations: { maskView.frame.size = CGSize(width: maxSize, height: maxSize) maskView.layer.cornerRadius = maxSize / 2.0 maskView.center = self.startPoint }) { flag in transitionContext.completeTransition(flag) } }åä¹‹ï¼ŒDismiss å¦‚ä¸‹class CustomDismissAnimation: NSObject, UIViewControllerAnimatedTransitioning { let endPoint: CGPoint var grayView: UIView! private let durationTime = 0.45 init(endPoint: CGPoint) { self.endPoint = endPoint super.init() } func transitionDuration(using transitionContext: UIViewControllerContextTransitioning?) -&amp;gt; TimeInterval { return durationTime } func animateTransition(using transitionContext: UIViewControllerContextTransitioning) { guard let fromView = transitionContext.viewController(forKey: .from)?.view else { return } let containerView = transitionContext.containerView let containerFrame = containerView.frame let maxY = max(containerFrame.height - endPoint.y, endPoint.y) let maxX = max(containerFrame.width - endPoint.x, endPoint.x) let maxSize = max(maxY, maxX) * 2.1 let maskView = UIView() maskView.frame.size = CGSize(width: maxSize, height: maxSize) maskView.center = endPoint maskView.backgroundColor = .black maskView.layer.cornerRadius = maxSize / 2.0 fromView.mask = maskView containerView.addSubview(fromView) UIView.animate( withDuration: durationTime, delay: 0, options: [.curveEaseOut], animations: { maskView.frame.size = CGSize(width: 1, height: 1) maskView.layer.cornerRadius = 0.5 maskView.center = self.endPoint }) { flag in transitionContext.completeTransition(!transitionContext.transitionWasCancelled) } }}è¬äº‹ä¿±å‚™ï¼Œåªæ¬ æ±é¢¨æ±è¥¿éƒ½å»ºç«‹å¥½å•¦ï¼Œæ¥è‘—å°±æ˜¯å¦‚ä½•ä½¿ç”¨äº† æˆ‘å€‘åœ¨ï¼¡ç•«é¢å»ºç«‹ CustomTransitionï¼Œç„¶å¾Œå°‡ï¼¢ç•«é¢çš„ transitioningDelegate æ”¹ç‚º CustomTransitionï¼Œ ä¸¦å°‡ modalPresentationStyle è¨­ç½®ç‚º .customclass PrepareToPushViewController: UIViewController { let button = UIButton(type: .system) let animation = CustomTransition() override func viewDidLoad() { super.viewDidLoad() // set view layout } }}// MARK: Setup UI methodsextension PrepareToPushViewController { @objc func buttonPressed() { let vc = PresentSecondViewController() animation.destinationPoint = button.center vc.transitioningDelegate = animation vc.modalPresentationStyle = .custom animation.interation.wire(viewController: vc) present(vc, animated: true, completion: nil) }}" }, { "title": "Swift æ•¸å­—è™•ç†å¤§å…¨", "url": "/posts/swift-number-detail/", "categories": "ç­†è¨˜", "tags": "swift, tip", "date": "2019-02-21 00:00:00 +0800", "snippet": "ä¹Ÿå¯ä»¥åˆ°æˆ‘çš„ Gist çœ‹å®Œæ•´çš„ code ğŸ˜„ç„¡æ¢ä»¶é€²ä½ (å°æ•¸ï¼Œæ•´æ•¸)æ•´æ•¸çš„ç„¡æ¢ä»¶é€²ä½ceil(11.2)// print 12// ceil çš„æ„æ€æ˜¯å¤©èŠ±æ¿ç„¡æ¢ä»¶é€²ä½è‡³ å°æ•¸ç¬¬xä½extension Double { func ceiling(toDecimal decimal: Int) -&amp;gt; Double { let numberOfDigits = abs(pow(10.0, Double(decimal))) if self.sign == .minus { return Double(Int(self * numberOfDigits)) / numberOfDigits } else { return Double(ceil(self * numberOfDigits)) / numberOfDigits } }}123.12345.ceiling(toDecimal: 3)// print 123.124 (-123.12345).ceiling(toDecimal: 3)// print -123.123ç„¡æ¢ä»¶é€²ä½è‡³ æ•´æ•¸ç¬¬xä½extension Double { func ceiling(toInteger integer: Int = 1) -&amp;gt; Double { let integer = integer - 1 let numberOfDigits = pow(10.0, Double(integer)) return Double(ceil(self / numberOfDigits)) * numberOfDigits }}123.12345.ceiling(toInteger: 2)// print 130.0(-123.12345).ceiling(toInteger: 2)// print -120.0å››æ¨äº”å…¥ (å°æ•¸ï¼Œæ•´æ•¸)lround(11.2) -&amp;gt; Int// print 11round(11.5) -&amp;gt; Double// print 12.0å››æ¨äº”å…¥è‡³ å°æ•¸ç¬¬xä½extension Double { func rounding(toDecimal decimal: Int) -&amp;gt; Double { let numberOfDigits = pow(10.0, Double(decimal)) return (self * numberOfDigits).rounded(.toNearestOrAwayFromZero) / numberOfDigits }}24.141.rounding(toDecimal: 2)// 24.1424.145.rounding(toDecimal: 2)// 24.15(-24.141).rounding(toDecimal: 2)// -24.14(-24.145).rounding(toDecimal: 2)// -24.15å››æ¨äº”å…¥è‡³ æ•´æ•¸ç¬¬xä½extension Double { func rounding(toInteger integer: Int) -&amp;gt; Double { let integer = integer - 1 let numberOfDigits = pow(10.0, Double(integer)) return (self / numberOfDigits).rounded(.toNearestOrAwayFromZero) * numberOfDigits }}124.141.rounding(toInteger: 2)// 120.0 125.141.rounding(toInteger: 2)// 130.0 (-124.141).rounding(toInteger: 2)// -120.0 (-125.141).rounding(toInteger: 2)// -130.0ç„¡æ¢ä»¶æ¨å» (å°æ•¸ï¼Œæ•´æ•¸)Int(11.24)// print 11ç„¡æ¢ä»¶æ¨å»è‡³ å°æ•¸ç¬¬xä½extension Double { func floor(toDecimal decimal: Int) -&amp;gt; Double { let numberOfDigits = pow(10.0, Double(decimal)) return (self * numberOfDigits).rounded(.towardZero) / numberOfDigits }}124.141.floor(toDecimal: 2)// print 124.14(-124.141).floor(toDecimal: 2)// print -124.14ç„¡æ¢ä»¶æ¨å»è‡³ æ•´æ•¸ç¬¬xä½extension Double { func floor(toInteger integer: Int) -&amp;gt; Double { let integer = integer - 1 let numberOfDigits = pow(10.0, Double(integer)) return (self / numberOfDigits).rounded(.towardZero) * numberOfDigits }}124.141.floor(toInteger: 2)// print 120.0 (-124.141).floor(toInteger: 2)// print -120.0" } ]
